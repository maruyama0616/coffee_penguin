{
  "name": "ãƒ¢ã‚«ã®Instagramè‡ªå‹•æŠ•ç¨¿ï¼ˆå®Œå…¨ç‰ˆï¼‰",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 0 19 * * *"
            }
          ]
        }
      },
      "id": "schedule",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "functionCode": "const date_theme = require('/home/ubuntu/coffee_penguin/automation/date_theme.py');\nconst today = new Date();\nconst theme_data = date_theme.get_theme_for_date(today);\n\nreturn {\n  json: {\n    prompt: `ãƒ¢ã‚«ï¼ˆMocha the Coffee Penguinï¼‰ã¨ã„ã†ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒã€${theme_data.theme}ã‚’ãƒ†ãƒ¼ãƒã«ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’æ¥½ã—ã‚“ã§ã„ã‚‹ã‚·ãƒ¼ãƒ³ã€‚èƒŒæ™¯ã«ã¯${theme_data.description}ã€‚ã‹ã‚ã„ã‚‰ã—ãã€æ¸©ã‹ã¿ã®ã‚ã‚‹ã‚¤ãƒ©ã‚¹ãƒˆé¢¨ã€‚`,\n    theme: theme_data.theme,\n    event_name: theme_data.event_name,\n    description: theme_data.description,\n    keywords: theme_data.keywords,\n    date: today.toISOString().split('T')[0]\n  }\n};"
      },
      "id": "get_theme",
      "name": "ãƒ†ãƒ¼ãƒå–å¾—",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "command": "cd /home/ubuntu/coffee_penguin/automation && python3 full_automation.py --prompt \"{{ $json.prompt }}\" --type image --prefix mocha --aspect-ratio 3:4"
      },
      "id": "generate_upload",
      "name": "ç”»åƒç”Ÿæˆâ†’Cloudinaryã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â†’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¨˜éŒ²",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "functionCode": "const output = $input.item.json.stdout;\nconst jsonMatch = output.match(/\\{[\\s\\S]*\"cloudinary_url\"[\\s\\S]*\\}/g);\n\nif (!jsonMatch) {\n  throw new Error('Cloudinary URLãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n}\n\nconst result = JSON.parse(jsonMatch[jsonMatch.length - 1]);\n\nreturn {\n  json: {\n    image_url: result.cloudinary_url,\n    filename: result.filename,\n    theme: $('ãƒ†ãƒ¼ãƒå–å¾—').item.json.theme,\n    event_name: $('ãƒ†ãƒ¼ãƒå–å¾—').item.json.event_name,\n    description: $('ãƒ†ãƒ¼ãƒå–å¾—').item.json.description,\n    keywords: $('ãƒ†ãƒ¼ãƒå–å¾—').item.json.keywords,\n    date: $('ãƒ†ãƒ¼ãƒå–å¾—').item.json.date\n  }\n};"
      },
      "id": "parse_result",
      "name": "çµæœãƒ‘ãƒ¼ã‚¹",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"gpt-4.1-mini\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"ã‚ãªãŸã¯ãƒ¢ã‚«ï¼ˆMocha the Coffee Penguinï¼‰ã¨ã„ã†ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã§ã™ã€‚\\n\\nã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š:\\n- åå‰: ãƒ¢ã‚« (Mocha)\\n- ç¨®æ—: çš‡å¸ãƒšãƒ³ã‚®ãƒ³ã®èµ¤ã¡ã‚ƒã‚“\\n- æ€§æ ¼: å…ƒæ°—ã§å¥½å¥‡å¿ƒæ—ºç››ã€ã‚³ãƒ¼ãƒ’ãƒ¼ãŒå¤§å¥½ã\\n- å£èª¿: è¦ªã—ã¿ã‚„ã™ãã€çµµæ–‡å­—ã‚’ä½¿ã†\\n\\nInstagramæŠ•ç¨¿ç”¨ã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚\\n\\nå½¢å¼:\\n1. ãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ2-3è¡Œã€çµµæ–‡å­—ã‚’å«ã‚€ï¼‰\\n2. æ”¹è¡Œ\\n3. ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆ5å€‹ã€æ—¥æœ¬èªã¨è‹±èªã®ãƒŸãƒƒã‚¯ã‚¹ã€ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šï¼‰\\n\\nä¾‹:\\nã‚„ã£ã¨é‡‘æ›œæ—¥ã ã­ï¼â˜•âœ¨\\né€±æœ«å‰ã®æ¸©ã‹ã„ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¿ã‚¤ãƒ ã§ã€å¿ƒã‚‚ä½“ã‚‚ã»ã£ã“ã‚ŠğŸ§ğŸ’•\\n\\n#é‡‘æ›œæ—¥ #ç™’ã— #ã‚³ãƒ¼ãƒ’ãƒ¼ #CoffeePenguin #MochaThePenguin\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"ä»Šæ—¥ã®ãƒ†ãƒ¼ãƒ: {{ $json.theme }}\\nã‚¤ãƒ™ãƒ³ãƒˆ: {{ $json.event_name }}\\nèª¬æ˜: {{ $json.description }}\\nã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: {{ $json.keywords.join(', ') }}\"\n    }\n  ],\n  \"temperature\": 0.8,\n  \"max_tokens\": 300\n}",
        "options": {}
      },
      "id": "openai",
      "name": "OpenAI - ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1050, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "1",
          "name": "OpenAI API Key"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const openaiResponse = $input.item.json.choices[0].message.content;\nconst parsedData = $('çµæœãƒ‘ãƒ¼ã‚¹').item.json;\n\nreturn {\n  json: {\n    image_url: parsedData.image_url,\n    caption: openaiResponse,\n    filename: parsedData.filename,\n    theme: parsedData.theme,\n    event_name: parsedData.event_name,\n    date: parsedData.date\n  }\n};"
      },
      "id": "function",
      "name": "ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³æ•´å½¢",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v18.0/{{ $env.INSTAGRAM_ACCOUNT_ID }}/media",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "image_url",
              "value": "={{ $json.image_url }}"
            },
            {
              "name": "caption",
              "value": "={{ $json.caption }}"
            },
            {
              "name": "access_token",
              "value": "={{ $env.PAGE_ACCESS_TOKEN }}"
            }
          ]
        },
        "options": {}
      },
      "id": "instagram_create",
      "name": "Instagram - ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "amount": 60,
        "unit": "seconds"
      },
      "id": "wait",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [1650, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v18.0/{{ $env.INSTAGRAM_ACCOUNT_ID }}/media_publish",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "creation_id",
              "value": "={{ $('Instagram - ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ').item.json.id }}"
            },
            {
              "name": "access_token",
              "value": "={{ $env.PAGE_ACCESS_TOKEN }}"
            }
          ]
        },
        "options": {}
      },
      "id": "instagram_publish",
      "name": "Instagram - å…¬é–‹",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1850, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.DISCORD_WEBHOOK_URL }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"embeds\": [{\n    \"title\": \"âœ… InstagramæŠ•ç¨¿å®Œäº†\",\n    \"description\": \"ãƒ¢ã‚«ã®æŠ•ç¨¿ãŒæˆåŠŸã—ã¾ã—ãŸï¼\",\n    \"color\": 5814783,\n    \"fields\": [\n      {\n        \"name\": \"æ—¥ä»˜\",\n        \"value\": \"{{ $('çµæœãƒ‘ãƒ¼ã‚¹').item.json.date }}\"\n      },\n      {\n        \"name\": \"ãƒ†ãƒ¼ãƒ\",\n        \"value\": \"{{ $('çµæœãƒ‘ãƒ¼ã‚¹').item.json.theme }}\"\n      },\n      {\n        \"name\": \"ã‚¤ãƒ™ãƒ³ãƒˆ\",\n        \"value\": \"{{ $('çµæœãƒ‘ãƒ¼ã‚¹').item.json.event_name }}\"\n      },\n      {\n        \"name\": \"ãƒ•ã‚¡ã‚¤ãƒ«å\",\n        \"value\": \"{{ $('çµæœãƒ‘ãƒ¼ã‚¹').item.json.filename }}\"\n      },\n      {\n        \"name\": \"InstagramæŠ•ç¨¿ID\",\n        \"value\": \"{{ $('Instagram - å…¬é–‹').item.json.id }}\"\n      }\n    ],\n    \"thumbnail\": {\n      \"url\": \"{{ $('çµæœãƒ‘ãƒ¼ã‚¹').item.json.image_url }}\"\n    },\n    \"timestamp\": \"{{ $now.toISOString() }}\"\n  }]\n}",
        "options": {}
      },
      "id": "discord",
      "name": "Discordé€šçŸ¥",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [2050, 300]
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "ãƒ†ãƒ¼ãƒå–å¾—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ãƒ†ãƒ¼ãƒå–å¾—": {
      "main": [
        [
          {
            "node": "ç”»åƒç”Ÿæˆâ†’Cloudinaryã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â†’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¨˜éŒ²",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç”»åƒç”Ÿæˆâ†’Cloudinaryã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â†’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¨˜éŒ²": {
      "main": [
        [
          {
            "node": "çµæœãƒ‘ãƒ¼ã‚¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "çµæœãƒ‘ãƒ¼ã‚¹": {
      "main": [
        [
          {
            "node": "OpenAI - ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI - ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆ": {
      "main": [
        [
          {
            "node": "ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³æ•´å½¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³æ•´å½¢": {
      "main": [
        [
          {
            "node": "Instagram - ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Instagram - ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Instagram - å…¬é–‹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Instagram - å…¬é–‹": {
      "main": [
        [
          {
            "node": "Discordé€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {},
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2026-02-10T00:00:00.000Z",
  "versionId": "3"
}
