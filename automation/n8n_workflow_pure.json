{
  "name": "ãƒ¢ã‚«ã®Instagramè‡ªå‹•æŠ•ç¨¿ï¼ˆN8Nå®Œçµç‰ˆï¼‰",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 0 19 * * *"
            }
          ]
        }
      },
      "id": "schedule_trigger",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [250, 400],
      "notes": "æ¯æ—¥æ—¥æœ¬æ™‚é–“19æ™‚ã«è‡ªå‹•å®Ÿè¡Œ"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "={{ $env.GOOGLE_SPREADSHEET_ID }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "ãƒ†ãƒ¼ãƒç®¡ç†",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "date",
              "displayName": "æ—¥ä»˜",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "theme",
              "displayName": "ãƒ†ãƒ¼ãƒ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "get_theme_from_sheet",
      "name": "ãƒ†ãƒ¼ãƒå–å¾—ï¼ˆGoogle Sheetsï¼‰",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [450, 400],
      "notes": "Google Sheetsã‹ã‚‰ã€Œpendingã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ†ãƒ¼ãƒã‚’å–å¾—",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "1",
              "leftValue": "={{ $json.status }}",
              "rightValue": "pending",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "filter_pending",
      "name": "Pendingã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [650, 400],
      "notes": "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œpendingã€ã®è¡Œã®ã¿å‡¦ç†"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "prompt",
              "value": "=ãƒ¢ã‚«ï¼ˆMocha the Coffee Penguinï¼‰ã¨ã„ã†ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒã€{{ $json.theme }}ã‚’ãƒ†ãƒ¼ãƒã«ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’æ¥½ã—ã‚“ã§ã„ã‚‹ã‚·ãƒ¼ãƒ³ã€‚ã‹ã‚ã„ã‚‰ã—ãã€æ¸©ã‹ã¿ã®ã‚ã‚‹ã‚¤ãƒ©ã‚¹ãƒˆé¢¨ã€‚ç¸¦é•·ã®3:4ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã€‚",
              "type": "string"
            },
            {
              "id": "2",
              "name": "filename",
              "value": "=mocha_{{ $now.format('yyyyMMdd_HHmmss') }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "date",
              "value": "={{ $json.date }}",
              "type": "string"
            },
            {
              "id": "4",
              "name": "theme",
              "value": "={{ $json.theme }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "prepare_prompt",
      "name": "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæº–å‚™",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [850, 300],
      "notes": "ç”»åƒç”Ÿæˆç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æº–å‚™"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "={{ $env.GEMINI_API_KEY }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [{\n    \"parts\": [{\n      \"text\": \"{{ $json.prompt }}\"\n    }]\n  }],\n  \"generationConfig\": {\n    \"response_modalities\": [\"image\"],\n    \"response_mime_type\": \"image/jpeg\"\n  }\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file",
              "outputPropertyName": "data"
            }
          }
        }
      },
      "id": "generate_image_gemini",
      "name": "ç”»åƒç”Ÿæˆï¼ˆGeminiï¼‰",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1050, 300],
      "notes": "Gemini 2.0 Flash Expã§ç”»åƒã‚’ç”Ÿæˆ"
    },
    {
      "parameters": {
        "operation": "upload",
        "binaryProperty": "data",
        "publicId": "={{ $('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæº–å‚™').item.json.filename }}",
        "folder": "mocha",
        "options": {
          "resourceType": "image"
        }
      },
      "id": "upload_to_cloudinary",
      "name": "Cloudinaryã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
      "type": "n8n-nodes-base.cloudinary",
      "typeVersion": 1,
      "position": [1250, 300],
      "notes": "ç”Ÿæˆã•ã‚ŒãŸç”»åƒã‚’Cloudinaryã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
      "credentials": {
        "cloudinaryApi": {
          "id": "1",
          "name": "Cloudinary account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "cloudinary_url",
              "value": "={{ $json.secure_url }}",
              "type": "string"
            },
            {
              "id": "2",
              "name": "filename",
              "value": "={{ $('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæº–å‚™').item.json.filename }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "prompt",
              "value": "={{ $('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæº–å‚™').item.json.prompt }}",
              "type": "string"
            },
            {
              "id": "4",
              "name": "date",
              "value": "={{ $('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæº–å‚™').item.json.date }}",
              "type": "string"
            },
            {
              "id": "5",
              "name": "theme",
              "value": "={{ $('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæº–å‚™').item.json.theme }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "extract_url",
      "name": "URLæŠ½å‡º",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1450, 300],
      "notes": "Cloudinary URLã‚’æŠ½å‡º"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "={{ $env.GOOGLE_SPREADSHEET_ID }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "ãƒ¡ãƒ‡ã‚£ã‚¢ç®¡ç†",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "filename",
              "displayName": "ãƒ•ã‚¡ã‚¤ãƒ«å",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cloudinary_url",
              "displayName": "Cloudinary URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "type",
              "displayName": "ã‚¿ã‚¤ãƒ—",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "prompt",
              "displayName": "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "date",
              "displayName": "æ—¥ä»˜",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "record_to_sheet",
      "name": "ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¨˜éŒ²",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1650, 300],
      "notes": "ãƒ•ã‚¡ã‚¤ãƒ«åã¨URLã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¨˜éŒ²",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $env.OPENAI_API_KEY }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"gpt-4.1-mini\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"ã‚ãªãŸã¯ãƒ¢ã‚«ï¼ˆMocha the Coffee Penguinï¼‰ã¨ã„ã†ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã§ã™ã€‚\\n\\nã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š:\\n- åå‰: ãƒ¢ã‚« (Mocha)\\n- ç¨®æ—: çš‡å¸ãƒšãƒ³ã‚®ãƒ³ã®èµ¤ã¡ã‚ƒã‚“\\n- æ€§æ ¼: å…ƒæ°—ã§å¥½å¥‡å¿ƒæ—ºç››ã€ã‚³ãƒ¼ãƒ’ãƒ¼ãŒå¤§å¥½ã\\n- å£èª¿: è¦ªã—ã¿ã‚„ã™ãã€çµµæ–‡å­—ã‚’ä½¿ã†\\n\\nInstagramæŠ•ç¨¿ç”¨ã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚\\n\\nå½¢å¼:\\n1. ãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ2-3è¡Œã€çµµæ–‡å­—ã‚’å«ã‚€ï¼‰\\n2. æ”¹è¡Œ\\n3. ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆ5å€‹ã€æ—¥æœ¬èªã¨è‹±èªã®ãƒŸãƒƒã‚¯ã‚¹ã€ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šï¼‰\\n\\nä¾‹:\\nã‚„ã£ã¨é‡‘æ›œæ—¥ã ã­ï¼â˜•âœ¨\\né€±æœ«å‰ã®æ¸©ã‹ã„ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¿ã‚¤ãƒ ã§ã€å¿ƒã‚‚ä½“ã‚‚ã»ã£ã“ã‚ŠğŸ§ğŸ’•\\n\\n#é‡‘æ›œæ—¥ #ç™’ã— #ã‚³ãƒ¼ãƒ’ãƒ¼ #CoffeePenguin #MochaThePenguin\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"ä»Šæ—¥ã®ãƒ†ãƒ¼ãƒ: {{ $('URLæŠ½å‡º').item.json.theme }}\"\n    }\n  ],\n  \"temperature\": 0.8,\n  \"max_tokens\": 300\n}",
        "options": {}
      },
      "id": "generate_caption",
      "name": "ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆï¼ˆOpenAIï¼‰",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1850, 300],
      "notes": "OpenAI GPT-4.1 Miniã§ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "caption",
              "value": "={{ $json.choices[0].message.content }}",
              "type": "string"
            },
            {
              "id": "2",
              "name": "image_url",
              "value": "={{ $('URLæŠ½å‡º').item.json.cloudinary_url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "prepare_instagram",
      "name": "InstagramæŠ•ç¨¿æº–å‚™",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [2050, 300],
      "notes": "InstagramæŠ•ç¨¿ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v18.0/{{ $env.INSTAGRAM_ACCOUNT_ID }}/media",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "image_url",
              "value": "={{ $json.image_url }}"
            },
            {
              "name": "caption",
              "value": "={{ $json.caption }}"
            },
            {
              "name": "access_token",
              "value": "={{ $env.PAGE_ACCESS_TOKEN }}"
            }
          ]
        },
        "options": {}
      },
      "id": "create_instagram_container",
      "name": "Instagram - ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2250, 300],
      "notes": "Instagram Graph APIã§ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ"
    },
    {
      "parameters": {
        "amount": 60,
        "unit": "seconds"
      },
      "id": "wait_for_processing",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [2450, 300],
      "notes": "Instagramã®ç”»åƒå‡¦ç†ã‚’å¾…ã¤ï¼ˆ60ç§’ï¼‰"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v18.0/{{ $env.INSTAGRAM_ACCOUNT_ID }}/media_publish",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "creation_id",
              "value": "={{ $('Instagram - ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ').item.json.id }}"
            },
            {
              "name": "access_token",
              "value": "={{ $env.PAGE_ACCESS_TOKEN }}"
            }
          ]
        },
        "options": {}
      },
      "id": "publish_instagram",
      "name": "Instagram - å…¬é–‹",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2650, 300],
      "notes": "Instagramã«æŠ•ç¨¿ã‚’å…¬é–‹"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $env.GOOGLE_SPREADSHEET_ID }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "ãƒ†ãƒ¼ãƒç®¡ç†",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "status": "posted"
          },
          "matchingColumns": ["date"],
          "schema": [
            {
              "id": "status",
              "displayName": "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "update_status",
      "name": "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [2850, 300],
      "notes": "ãƒ†ãƒ¼ãƒç®¡ç†ã‚·ãƒ¼ãƒˆã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œpostedã€ã«æ›´æ–°",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "ãƒ†ãƒ¼ãƒå–å¾—ï¼ˆGoogle Sheetsï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ãƒ†ãƒ¼ãƒå–å¾—ï¼ˆGoogle Sheetsï¼‰": {
      "main": [
        [
          {
            "node": "Pendingã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pendingã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼": {
      "main": [
        [
          {
            "node": "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæº–å‚™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæº–å‚™": {
      "main": [
        [
          {
            "node": "ç”»åƒç”Ÿæˆï¼ˆGeminiï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç”»åƒç”Ÿæˆï¼ˆGeminiï¼‰": {
      "main": [
        [
          {
            "node": "Cloudinaryã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cloudinaryã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰": {
      "main": [
        [
          {
            "node": "URLæŠ½å‡º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "URLæŠ½å‡º": {
      "main": [
        [
          {
            "node": "ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¨˜éŒ²",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¨˜éŒ²": {
      "main": [
        [
          {
            "node": "ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆï¼ˆOpenAIï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆï¼ˆOpenAIï¼‰": {
      "main": [
        [
          {
            "node": "InstagramæŠ•ç¨¿æº–å‚™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "InstagramæŠ•ç¨¿æº–å‚™": {
      "main": [
        [
          {
            "node": "Instagram - ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Instagram - ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Instagram - å…¬é–‹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Instagram - å…¬é–‹": {
      "main": [
        [
          {
            "node": "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2026-02-10T00:00:00.000Z",
  "versionId": "1"
}
